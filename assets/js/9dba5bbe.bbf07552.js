"use strict";(self.webpackChunkgetstart=self.webpackChunkgetstart||[]).push([[600],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>w});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var d=n.createContext({}),l=function(e){var t=n.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(d.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=l(r),p=a,w=m["".concat(d,".").concat(p)]||m[p]||u[p]||o;return r?n.createElement(w,s(s({ref:t},c),{},{components:r})):n.createElement(w,s({ref:t},c))}));function w(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=p;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i[m]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},1592:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=r(7462),a=(r(7294),r(3905));const o={title:"Setup Swarm",sidebar_label:"Swarm Mode",sidebar_position:4,pagination_next:"stack/traefik/traefik",tags:["docker swarm"]},s=void 0,i={unversionedId:"swarm-mode",id:"swarm-mode",title:"Setup Swarm",description:"For truly highly-available services with Docker containers, we need an orchestration system. Docker Swarm is the simplest way to achieve redundancy, such that a single docker host could be turned off, and none of our services will be interrupted.",source:"@site/docs-docker-swarm/swarm-mode.md",sourceDirName:".",slug:"/swarm-mode",permalink:"/getstart/docker-swarm/swarm-mode",draft:!1,tags:[{label:"docker swarm",permalink:"/getstart/docker-swarm/tags/docker-swarm"}],version:"current",lastUpdatedBy:"imoize",lastUpdatedAt:1691211684,formattedLastUpdatedAt:"Aug 5, 2023",sidebarPosition:4,frontMatter:{title:"Setup Swarm",sidebar_label:"Swarm Mode",sidebar_position:4,pagination_next:"stack/traefik/traefik",tags:["docker swarm"]},sidebar:"tutorialSidebar",previous:{title:"Shared Storage (Ceph)",permalink:"/getstart/docker-swarm/shared-storage"},next:{title:"Traefik",permalink:"/getstart/docker-swarm/stack/traefik"}},d={},l=[{value:"Init Swarm",id:"init-swarm",level:2},{value:"Recommendation",id:"recommendation",level:3}],c={toc:l},m="wrapper";function u(e){let{components:t,...r}=e;return(0,a.kt)(m,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"For truly highly-available services with Docker containers, we need an orchestration system. Docker Swarm is the simplest way to achieve redundancy, such that a single docker host could be turned off, and none of our services will be interrupted."),(0,a.kt)("h2",{id:"init-swarm"},"Init Swarm"),(0,a.kt)("p",null,"Now, to launch a swarm. Pick a target node, and run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker swarm init --advertise-addr <MANAGER-IP>\n")),(0,a.kt)("p",null,"You will see output like this"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root@node-01 ~]# sudo docker swarm init --advertise-addr 192.168.0.21\nSwarm initialized: current node (b54vls3wf8xzbhwz79nlkivt8) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-2orjbzjzjvm1bbo736xxmxzwaf4rffxwi0tu3zonjlsek4mja0-bsud7xnvhv4cicwi7l6c9s6l0 \\\n    192.168.0.21:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\n[root@node-01 ~]#\n")),(0,a.kt)("p",null,"To confirm that you have a node swarm, run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker node ls\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root@node-01 ~]# sudo docker node ls\nID                           HOSTNAME                STATUS  AVAILABILITY  MANAGER STATUS\nb54vls3wf8xzbhwz79nlkivt8 *  nd1.domain.com          Ready     Active         Leader\n[root@node-01 ~]#\n")),(0,a.kt)("p",null,"Note that when you run docker swarm init above, the CLI output gives youe a command to run to join further nodes to my swarm. This command would join the nodes as workers (as opposed to managers). Workers can easily be promoted to managers (and demoted again), but since we know that we want our other two nodes to be managers too, it's simpler just to add them to the swarm as managers immediately."),(0,a.kt)("p",null,"On the first swarm node, generate the necessary token to join another manager by running"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo docker swarm join-token manager\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root@node-01 ~]# sudo docker swarm join-token manager\nTo add a manager to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-2orjbzjzjvm1bbo736xxmxzwaf4rffxwi0tu3zopal4xk4mja0-cfm24bq2zvfkcwujwlp5zqxta \\\n    192.168.0.21:2377\n\n[root@node-01 ~]#\n")),(0,a.kt)("p",null,"Run the command provided on your other nodes to join them to the swarm as managers. After addition of a node, the output of docker node ls (on either host) should reflect all the nodes:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[root@node-02]# sudo docker node ls\nID                           HOSTNAME                STATUS  AVAILABILITY  MANAGER STATUS\nb54vls3wf8xzbhwz79nlkivt8 *  nd1.domain.com           Ready   Active        Leader\nxmw49jt5a1j87a6ihul76gbgy    nd2.domain.com           Ready   Active        Reachable\n[root@node-02]#\n")),(0,a.kt)("h3",{id:"recommendation"},"Recommendation"),(0,a.kt)("p",null,"The next step after setup swarm is deploy Traefik."))}u.isMDXComponent=!0}}]);