"use strict";(self.webpackChunkgetstart=self.webpackChunkgetstart||[]).push([[635],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>b});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),u=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,b=p["".concat(s,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(b,i(i({ref:t},c),{},{components:n})):o.createElement(b,i({ref:t},c))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4469:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var o=n(7462),r=(n(7294),n(3905));const a={title:"Setup Nodes",sidebar_label:"Nodes",sidebar_position:2,pagination_prev:null,tags:["docker swarm"]},i=void 0,l={unversionedId:"nodes",id:"nodes",title:"Setup Nodes",description:"Let's start building our cluster. You can use either bare-metal machines or virtual machines - the configuration would be the same.",source:"@site/docs-docker-swarm/nodes.md",sourceDirName:".",slug:"/nodes",permalink:"/getstart/docker-swarm/nodes",draft:!1,tags:[{label:"docker swarm",permalink:"/getstart/docker-swarm/tags/docker-swarm"}],version:"current",lastUpdatedBy:"imoize",lastUpdatedAt:1691211684,formattedLastUpdatedAt:"Aug 5, 2023",sidebarPosition:2,frontMatter:{title:"Setup Nodes",sidebar_label:"Nodes",sidebar_position:2,pagination_prev:null,tags:["docker swarm"]},sidebar:"tutorialSidebar",next:{title:"Shared Storage (Ceph)",permalink:"/getstart/docker-swarm/shared-storage"}},s={},u=[{value:"Install Docker",id:"install-docker",level:3},{value:"Permit connectivity",id:"permit-connectivity",level:3},{value:"Enable hostname resolution",id:"enable-hostname-resolution",level:3},{value:"Set Timezone",id:"set-timezone",level:3}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Let's start building our cluster. You can use either bare-metal machines or virtual machines - the configuration would be the same."),(0,r.kt)("p",null,"Here i use Proxmox ubuntu cloud image VM's."),(0,r.kt)("admonition",{title:"What we'll to do:",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"3 x nodes (bare-metal or VMs), each with:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"A mainstream Linux OS"),(0,r.kt)("li",{parentName:"ul"},"At least 2GB RAM"),(0,r.kt)("li",{parentName:"ul"},"At least 20GB disk space (but it'll be tight)")),(0,r.kt)("p",{parentName:"admonition"},"Connectivity to each other within the same subnet, and on a low-latency link (i.e., no WAN links)")),(0,r.kt)("admonition",{title:"note",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"All step below must be done in all nodes.")),(0,r.kt)("h3",{id:"install-docker"},"Install Docker"),(0,r.kt)("p",null,"Follow this ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/ubuntu/#installation-methods"},"link")," to setup docker for ubuntu."),(0,r.kt)("h3",{id:"permit-connectivity"},"Permit connectivity"),(0,r.kt)("p",null,"Most modern Linux distributions include firewall rules which only only permit minimal required incoming connections (like SSH). We'll want to allow all traffic between our nodes."),(0,r.kt)("p",null,"Install the (non-default) persistent iptables tools, by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install iptables-persistent\n")),(0,r.kt)("p",null,"Establishing some default rules (dkpg will prompt you to save current ruleset), and then add something like this to /etc/iptables/rules.v4:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo micro /etc/iptables/rules.v4\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Allow all inter-node communication\n-A INPUT -s 192.168.0.0/24 -j ACCEPT\n")),(0,r.kt)("p",null,"And refresh your running iptables rules with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables-restore < /etc/iptables/rules.v4\n")),(0,r.kt)("h3",{id:"enable-hostname-resolution"},"Enable hostname resolution"),(0,r.kt)("p",null,"Depending on your hosting environment, you may have DNS automatically setup for your VMs. If not, it's useful to set up static entries in /etc/hosts for the nodes. For example, I setup the following:"),(0,r.kt)("p",null,"192.168.0.21 node-01 nd1.domain.com"),(0,r.kt)("p",null,"192.168.0.22 node-02 nd2.domain.com"),(0,r.kt)("p",null,"192.168.0.23 node-03 nd3.domain.com"),(0,r.kt)("admonition",{title:"note",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"With ubuntu cloud image, if you edit hostname in /etc/hosts when server reboot cloud-init will overwrite it."),(0,r.kt)("p",{parentName:"admonition"},"To solve this you can edit in /etc/cloud/templates/hosts.debian.tmpl or comment out ",(0,r.kt)("inlineCode",{parentName:"p"},"update_etc_hosts")," in /etc/cloud/cloud.cfg")),(0,r.kt)("h3",{id:"set-timezone"},"Set Timezone"),(0,r.kt)("p",null,"Set your local timezone, by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo timedatectl set-timezone America/New_York\nsudo timedatectl set-ntp on\n")))}d.isMDXComponent=!0}}]);