"use strict";(self.webpackChunkgetstart=self.webpackChunkgetstart||[]).push([[164],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>f});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(a),m=l,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return a?n.createElement(f,i(i({ref:t},p),{},{components:a})):n.createElement(f,i({ref:t},p))}));function f(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,i=new Array(r);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:l,i[1]=o;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},240:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var n=a(7462),l=(a(7294),a(3905));const r={id:"tail",title:"Tailscale as subnet router inside lxc",sidebar_label:"Tailscale Subnet",sidebar_position:1,keywords:["lxc","proxmox","tailscale"],tags:["lxc","proxmox","tailscale"]},i=void 0,o={unversionedId:"proxmox/lxc/tail",id:"proxmox/lxc/tail",title:"Tailscale as subnet router inside lxc",description:"As i'm often use tailscale for remote my homelab i decide to use tailscale as subnet.",source:"@site/docs/proxmox/lxc/tailscale-subnet-router.md",sourceDirName:"proxmox/lxc",slug:"/proxmox/lxc/tail",permalink:"/getstart/proxmox/lxc/tail",draft:!1,tags:[{label:"lxc",permalink:"/getstart/tags/lxc"},{label:"proxmox",permalink:"/getstart/tags/proxmox"},{label:"tailscale",permalink:"/getstart/tags/tailscale"}],version:"current",lastUpdatedBy:"imoize",lastUpdatedAt:1691211684,formattedLastUpdatedAt:"Aug 5, 2023",sidebarPosition:1,frontMatter:{id:"tail",title:"Tailscale as subnet router inside lxc",sidebar_label:"Tailscale Subnet",sidebar_position:1,keywords:["lxc","proxmox","tailscale"],tags:["lxc","proxmox","tailscale"]},sidebar:"tutorialSidebar",previous:{title:"Portainer",permalink:"/getstart/docker/compose/portainer"},next:{title:"Install Docker on LXC",permalink:"/getstart/proxmox/lxc/install-docker-on-lxc"}},s={},c=[{value:"Create Lxc",id:"create-lxc",level:3},{value:"Host config",id:"host-config",level:3},{value:"Container config",id:"container-config",level:3},{value:"Reference",id:"reference",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...r}=e;return(0,l.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"As i'm often use tailscale for remote my homelab i decide to use tailscale as subnet."),(0,l.kt)("p",null,"We already know lxc is realy lightweight and fast so i will install tailscale with Alpine Linux inside Proxmox LXC."),(0,l.kt)("h3",{id:"create-lxc"},"Create Lxc"),(0,l.kt)("p",null,"Create container in Proxmox "),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(1861).Z,width:"722",height:"515"})),(0,l.kt)("p",null,"I choose Alpine Linux 3.18 image."),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(1433).Z,width:"722",height:"515"})),(0,l.kt)("p",null,"For disk size 1GB is enough"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(4356).Z,width:"722",height:"515"})),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(497).Z,width:"722",height:"515"})),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(646).Z,width:"722",height:"515"})),(0,l.kt)("p",null,"After container created next we need add config to ",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/pve/lxc/300.conf")," ( where 300.conf is ID of created container )."),(0,l.kt)("h3",{id:"host-config"},"Host config"),(0,l.kt)("p",null,"Tailscale subnet need ipv4 forwarding enable if not enable in the host subnet will not work."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"uncomment this line in ",(0,l.kt)("inlineCode",{parentName:"li"},"/etc/sysctl.conf"),":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"#net.ipv4.ip.forward=1\nand\n#net.ipv6.conf.all.forwarding=1\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"To bring up Tailscale in an unprivileged container, access to the /dev/tun device can be enabled in the config for the LXC. For example unprivileged LXC with ID 300, the following lines would be added to ",(0,l.kt)("inlineCode",{parentName:"li"},"/etc/pve/lxc/300.conf"),":")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"lxc.cgroup2.devices.allow: c 10:200 rwm\nlxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Reboot host.")),(0,l.kt)("admonition",{title:"Note!",type:"danger"},(0,l.kt)("p",{parentName:"admonition"},"It\u2019s important that the container is stopped when you try to edit the file, otherwise Proxmox\u2019s network filesystem will prevent you from saving it.")),(0,l.kt)("h3",{id:"container-config"},"Container config"),(0,l.kt)("p",null,"After all necessery configuration done in Proxmox host next start container."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Enable IP forwarding in guest container")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"echo 'net.ipv4.ip_forward = 1' | tee -a /etc/sysctl.d/99-tailscale.conf\necho 'net.ipv6.conf.all.forwarding = 1' | tee -a /etc/sysctl.d/99-tailscale.conf\nsysctl -p /etc/sysctl.d/99-tailscale.conf\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Install Tailscale")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"apk add tailscale\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Enable tailscaled service")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"rc-update add tailscale\nrc-service tailscale start\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"Authenticate and connect machine to Tailscale network")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale up --advertise-routes=10.0.0.0/24,10.0.1.0/24\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Change IP to match your need"))),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"Enable subnet routes from admin console")),(0,l.kt)("p",null,"Using the ellipsis icon menu at the end of the table, select Edit route settings. This will open up the Edit route settings panel."),(0,l.kt)("p",null,"Click Approve all on your routes so that Tailscale distributes the subnet routes to the rest of the nodes on your Tailscale network. Alternatively, you can approve each route individually by clicking the toggle to the left of the route."),(0,l.kt)("h3",{id:"reference"},"Reference"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://tailscale.com/kb/1130/lxc-unprivileged/"},"https://tailscale.com/kb/1130/lxc-unprivileged/")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://tailscale.com/kb/1019/subnets/?tab=linux"},"https://tailscale.com/kb/1019/subnets/?tab=linux")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/tailscale/tailscale/issues/3790"},"https://github.com/tailscale/tailscale/issues/3790")))}d.isMDXComponent=!0},1861:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/figure1-fc1be3cfa6e8f0232060c6a0c01b7dc3.png"},1433:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/figure2-8704f59406f65bc88dbaded74cd402a6.png"},4356:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/figure3-65791bb9eec4af1e2e788ec72070c2f1.png"},497:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/figure4-e8badaf3925e54c2d70c0ff9cb663925.png"},646:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/figure5-f348b2ef1951d8e41d1da586e823fc25.png"}}]);